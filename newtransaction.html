<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHEDDR</title>

  <link rel="stylesheet" href="css/cheddrme.css" />
  <link rel="stylesheet" href="css/foundation.css" />
  <link rel="stylesheet" href="css/foundation-icons.css" />
  <link rel="stylesheet" href="css/toastr.min.css"/>
  <script type="text/javascript" src="js/vendor/jquery.js"></script>  
  <script type="text/javascript" src="js/foundation.min.js"></script>
  <script type="text/javascript" src="js/kjua-0.1.1.min.js"></script>
  <script type="text/javascript" src="js/toastr.min.js"></script>
  <script type="text/javascript" src="js/cheddrme.js"></script>

  <!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/js/foundation.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kjua@0.1.2/dist/kjua.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  -->
  

  <script type="text/javascript">
  var paymentAddress = "bitcoincash:qp7zfgk6qfk0dkcf4rd40p7ergrw7fr72v6ed98y4f";

  var fiat = "AUD";
  var currentExchangeRate = 0;
  var transFee = 0;

  var transFeeBCH = 0.00000681;
  var transFeeBits = parseFloat(transFeeBCH * 1000000).toFixed(2);

  var subTotal = 0;
  var finalTotal = 0;

  var subTotalBits = 0;
  var finalTotalBits = 0;

  var subTotalBCH = 0;
  var finalTotalBCH = 0;

  toastr.options = {
    "closeButton": true,
    "debug": false,
    "newestOnTop": false,
    "progressBar": false,
    "positionClass": "toast-top-left",
    "preventDuplicates": false,
    "onclick": null,
    "showDuration": "300",
    "hideDuration": "1000",
    "timeOut": "5000",
    "extendedTimeOut": "1000",
    "showEasing": "swing",
    "hideEasing": "linear",
    "showMethod": "fadeIn",
    "hideMethod": "fadeOut"
  }

  $(document).ready(function () {
    $('#paymentSummary').hide();
    $('#displayFiat').text(fiat);

    $("table#orderTable tr:even").css("background-color", "#F4F4F8");
    $("table#orderTable tr:odd").css("background-color", "#EFF1F1");

    $.get("https://api.coinmarketcap.com/v1/ticker/bitcoin-cash/?convert=" + fiat)
      .then( function (data, status) {
        var dateVar = "2010-10-30";
        var exchangeUpdated = new Date(dateVar);
        currentExchangeRate = data[0].price_aud;
        if (currentExchangeRate > 0) {
          toastr.info('1 BCH = ' + fiat + '$' + parseFloat(currentExchangeRate).toFixed(2));
          transFee = parseFloat(transFeeBCH * currentExchangeRate);
          transFeeBits = parseFloat(transFeeBCH * 1000000).toFixed(2);
        } else { 
          toastr.error('Could not retrieve exchange rate');
        } })
      .fail( function() {
          toastr.error('Could not retrieve exchange rate');
    });

    var result = 0;
    var prevEntry = 0;
    var operation = null;
    var currentEntry = '0';
    updateScreen(result);

    $("#clearInput").click(function () {
    updateScreen(0);
    });

    $("#deleteItem").click(function () {

    });

    $("#addToOrder").click(function () {
    var itemPrice = parseFloat($('#display').val()).toFixed(2);
    var itemPriceBCH = 0;

    if (itemPrice > 0) {
        subTotal = parseFloat(subTotal) + parseFloat(itemPrice);
        finalTotal = parseFloat(subTotal);

        itemPriceBCH = (parseFloat(itemPrice) / parseFloat(currentExchangeRate)).toFixed(10);
        subTotalBCH = parseFloat(subTotalBCH) + parseFloat(itemPriceBCH);
        finalTotalBCH = parseFloat(subTotalBCH);

        itemPriceBits = parseFloat(itemPriceBCH * 1000000).toFixed(2);
        subTotalBits = parseFloat(subTotalBCH * 1000000).toFixed(2);
        finalTotalBits = parseFloat(finalTotalBCH * 1000000).toFixed(2);

        $("#orderedItems").append('<tr><td><i class="fi-x">&nbsp;</i></td><td>$' + itemPrice + '</td><td>' + thousands(itemPriceBits) + '</td></tr><hr width=0>');
        $('#orderedItems').scrollTop($('#orderedItems')[0].scrollHeight);

        updateTotals();
    } 
    });

    $("#orderCheckout").click(function () {
      $('#addToOrder').click();
      if (finalTotal > 0) {
          $('#paymentSummary').show();
          $('#rightCard').hide();
          var qrcode = kjua({
          text: paymentAddress,
          ecLevel: 'H',
          size: 256,
          rounded: 100,
          quiet: 0,
          mSize: 26,
          mPosX: 50,
          mPosY: 50
          });
          if ($('#paymentCode').is(':empty')) {
            /* $("#paymentTitle").text
            /* ' (' + fiat + '$' +
                finalTotal.toFixed(2) + ') to:'); */
            $("#paymentTitle").empty();
            $("#paymentTitle").append('Please transfer <span class="success label finalTotal">₿' + finalTotalBCH.toFixed(8) + '</span> to:');
            $("#paymentCode").append(qrcode);
            $("#paymentAddress").val(paymentAddress);
          }
        } else {
          toastr.error('No items to checkout');
        }
    });

    $("#orderCancel").click(function () {
      $('#rightCard').show();
      $('#paymentSummary').hide();
      $('#paymentCode').empty();
    });

    $("#orderDone").click(function () {
      location.reload();
    });

    $('.button').on('click', function (evt) {
    var buttonPressed = $(this).html();
    if (buttonPressed === "C") {
        result = 0;
        currentEntry = '0';
    } else if (buttonPressed === "back") {
        //currentEntry = currentEntry.substring(0, currentEntry.length-1);
    } else if (buttonPressed === "+/-") {
        currentEntry *= -1;
    } else if (buttonPressed === '.') {
        currentEntry += '.';
    } else if (isNumber(buttonPressed)) {
        if (currentEntry === '0') currentEntry = buttonPressed;
        else currentEntry = currentEntry + buttonPressed;
    } else {
        currentEntry = '';
    }

    updateScreen(currentEntry);
    });

    $("#copyPaymentAddress").click(function () {
      copyToClipboard(document.getElementById("paymentAddress"));
      toastr.success('Copied to clipboard')
    });

});
  </script>
</head>

<body>
  <br>
  <div class="row align-center medium-unstack medium-8 large-8 text-center">
    <div class="medium-4 large-4 columns callout text-center">

      <h2><i class="fi-bitcoin-circle"> </i>CHEDDR</h2>

      <hr>
      <div class="large-12 medium-12 columns">
        <div class="input-group">
          <span class="input-group-label">$</span>
          <input class="input-group-field" type="text" id="display">
        </div>
      </div>

      <hr>
      <section>
        <div class="expanded button-group">
          <a class="hollow button">7</a>
          <a class="hollow button">8</a>
          <a class="hollow button">9</a>
        </div>

        <div class="expanded button-group">
          <a class="hollow button">4</a>
          <a class="hollow button">5</a>
          <a class="hollow button">6</a>
        </div>

        <div class="expanded button-group">
          <a class="hollow button">1</a>
          <a class="hollow button">2</a>
          <a class="hollow button">3</a>
        </div>

        <div class="expanded button-group">
          <a class="hollow secondary button">.</a>
          <a class="hollow button">0</a>
          <a class="hollow success button" id="addToOrder">
            <i class="fi-plus"></i>
          </a>
        </div>

        <div class="expanded button-group">
          <a class="warning button" id="clearInput">
            <i class="fi-minus-circle"></i>
          </a>

          <a class="success hollow button" id="orderCheckout">
            <img src="images/BitcoinCashLogo64.png"><br />
          </a>
        </div>
      </section>

      <hr>
    </div>
    <!-- end left card -->


    <!-- payment summary -->
    <div class="large-7 medium-7 columns text-center" id="paymentSummary">
      <div class="callout">
        <h5>Checkout</h5><hr>
        
        <p id="paymentTitle"></p>
        
        <div class="input-group">
            <input class="input-group-field" type="text" id="paymentAddress">
            <div class="input-group-button">
                <button id="copyPaymentAddress" data-clipboard-target="#paymentAddress">
                <i class="fi-clipboard"></i>
                </button>
          </div>
        </div>

        <div>
          <p>or scan QR Code:</p>
          <p id="paymentCode"></p>
        </div>

        <div>
            <span id="transactionFee"></span>
            <span class="warning round radius label" id="transFeeRecommended"></span> bits per kilobyte
        </div>

        <hr>
        <div>
          <a class="alert large-2 button" id="orderCancel"><i class="fi-x-circle"> Cancel</i></a>
          <a class="success large-2 button" id="orderDone"><i class="fi-check"> Done</i></a>
        </div>
      </div>
    </div>
    <!-- end payment summary -->


    <!-- order summary -->
    <div class="large-8 columns">
      <table width="100%">
          <thead>
          <tr>
              <th width="10px;">Item</th>
              <th width="20px;" id="displayFiat"></th>
              <th width="30px;">bits (µBCH)</th>
          </tr>
          </thead>
          <tbody id="orderedItems" style="height: 500px; overflow-y: auto; overflow-x: hidden;">
          </tbody>
      </table>
    </div>
    <!-- end order summary -->

    <hr>

    <!-- totals -->
    <div class="large-8 columns">
      <div id="orderSubTotal">
        <div class="medium-5 large-5 columns">
          <section>
            <h5>Sub-Total</h5>
          </section>
        </div>
        <div class="medium-3 large-3 columns">
          <section>
            <h5 id="orderSubTotalFiat">&nbsp;</h5>
          </section>
        </div>
        <div class="medium-4 large-4 columns">
          <section>
            <h5 id="orderSubTotalBits">&nbsp;</h5>
          </section>
        </div>
      </div>

      <hr>

      <div id="orderTotal">
        <div class="medium-5 large-5 columns">
          <section>
            <h2 class="orderTotal">Total</h2>
          </section>
        </div>
        <div class="medium-3 large-3 columns">
          <section style="padding-top: 15px;">
            <h4 class="orderTotal" id="orderTotalFiat">&nbsp;</h4>
          </section>
        </div>
        <div class="medium-4 large-4 columns">
          <section>
            <h2 class="orderTotal" id="orderTotalBits">&nbsp;</h2>
          </section>
          <section>
            <h4 class="orderTotal" id="orderTotalBCH"></h4>
          </section>
        </div>
      </div>
      </div>
    </div>
    <!-- end totals -->
    
    <!-- end right card -->

    <!-- start footer -->
    <div class="medium-12 large-12 columns text-center">
       
    </div>
    <!-- end footer --> 
  </div>
</body>

</html>